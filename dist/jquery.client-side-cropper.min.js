if("undefined"==typeof jQuery)throw new Error("This plugin requires jQuery");if("undefined"==typeof FileAPI)throw new Error("This plugin requires FileAPI plugin. Repository: https://github.com/mailru/FileAPI");!function(i){"use strict";var e=i.fn.jquery.split(" ")[0].split(".");if(e[0]<2&&e[1]<9||1==e[0]&&9==e[1]&&e[2]<1||e[0]>3)throw new Error("This plugin requires jQuery version 1.9.1 or higher, but lower than version 4");if("undefined"==typeof i.fn.modal)throw new Error("This plugin requires jQuery modal plugin. Optimized for bootstrap modal");if("undefined"==typeof i.fn.fileapi)throw new Error("This plugin requires jquery.fileapi plugin. Repository: https://github.com/RubaXa/jquery.fileapi");if("undefined"==typeof i.fn.Jcrop)throw new Error("This plugin requires jquery.Jcrop plugin. Repository: https://github.com/tapmodo/Jcrop")}(jQuery),function(i){"use strict";function e(i,e){var t=e.newFileWidth+100;t<586&&(t=586);var o=t/2;i.css({left:"50%","margin-left":"-"+o+"px",width:t+"px"}),i.find(".modal-dialog").css({width:t+"px"}),i.find(".modal-content").css({height:e.newFileHeight+170+"px",width:t+"px","text-align":"center"});var r=i.find(".js-img");r.css({height:e.newFileHeight+"px",width:e.newFileWidth+"px",display:"inline-block"})}function t(e,t,o){var r=e.height,n=e.width,a=i(window).width()-200,d=i(window).height()-250,l="square",s=0,p=r,u=n,v=t,h=o;r>n&&(l="vertical",u>a&&(s=u/a,p/=s,u/=s,v/=s,h/=s),p>d&&(s=p/d,p/=s,u/=s,v/=s,h/=s)),r<n&&(l="horizontal",u>a&&(s=u/a,p/=s,u/=s,v/=s,h/=s),p>d&&(s=p/d,p/=s,u/=s,v/=s,h/=s));var c=t/o;return{maxWindowWidth:a,maxWindowHeight:d,fileWidth:n,fileHeight:r,orientation:l,minWidth:t,minHeight:o,mod:s,newFileWidth:parseInt(u),newFileHeight:parseInt(p),newMinWidth:parseInt(v),newMinHeight:parseInt(h),aspectRatio:c}}function o(e){e=m;var t="clientSideCropperCropModalDiv_"+c,o='<div class="modal fade" id="'+t+'" tabindex="-1" role="dialog" aria-labelledby="'+t+'Label" data-backdrop="static" data-keyboard="false"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="'+t+'Label">'+e.titleText+'</h4></div><div class="modal-body"><div class="js-img"></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">'+e.closeBtnText+'</button><button type="submit" class="btn btn-primary js-upload">'+e.saveBtnText+"</button></div></div></div></div>";return c++,i("body").append(o),t}function r(i){void 0!==i&&(i.titleText&&(m.titleText=i.titleText),i.closeBtnText&&(m.closeBtnText=i.closeBtnText),i.saveBtnText&&(m.saveBtnText=i.saveBtnText))}function n(i){var e=i.attr("data-action");void 0===e&&(e=f.url);var t=i.attr("data-imageType"),o={type:i.attr("data-imageType")};void 0===t&&(o=f.data);var r=i.attr("data-minWidth");r=void 0===r?f.minWidth:parseInt(r);var n=i.attr("data-minHeight");n=void 0===n?f.minHeight:parseInt(n);var a=i.attr("data-cropModalDivId");void 0===a&&(a=f.cropModalDivId());var d=i.attr("data-previewHeight");d=void 0===d?f.previewHeight:parseInt(d);var l=i.attr("data-previewWidth");l=void 0===l?f.previewWidth:parseInt(l);var s=i.attr("data-lockModalDivId");void 0===l&&(s=f.lockModalDivId);var p=f.onError,u=f.onSuccess;return{url:e,data:o,minWidth:r,minHeight:n,cropModalDivId:a,previewHeight:d,previewWidth:l,lockModalDivId:s,onError:p,onSuccess:u}}function a(i,e){var t=n(i),o=e.url;void 0===o&&(o=t.url);var r=e.data;void 0===r&&(r=t.data);var a=e.minWidth;void 0===a&&(a=t.minWidth);var d=e.minHeight;void 0===d&&(d=t.minHeight);var l=e.cropModalDivId;void 0!==l&&"auto"!==l||(l=t.cropModalDivId);var s=e.previewHeight;void 0===s&&(s=t.previewHeight);var p=e.previewWidth;void 0===p&&(p=t.previewWidth);var u=e.lockModalDivId;void 0===u&&(u=t.lockModalDivId);var v=e.onError;void 0===v&&(v=t.onError);var h=e.onSuccess;return void 0===h&&(h=t.onSuccess),{url:o,data:r,minWidth:a,minHeight:d,cropModalDivId:l,previewHeight:s,previewWidth:p,lockModalDivId:u,onError:v,onSuccess:h}}function d(e,t){t.url.length||t.onError(g.actionUrlRequired);var o=i("#"+t.cropModalDivId);o.length||t.onError(g.cropModalDivNotExists(t.cropModalDivId));var r=e.find(".uploaded");r.length||t.onError(g.uploadedDivNotFount);var n=e.find(".js-preview");n.length||t.onError(g.previewDivNotFount);var a=e.find(".js-browse");a.length||t.onError(g.browseDivNotFount);var d=e.find('input[type="file"]');d.length||t.onError(g.fileInputNotFount);var l=o.find(".js-img");l.length||t.onError(g.imageAreaInCropModalDivNotFound);var s=o.find('[type="submit"]');s.length||t.onError(g.submitButtonInCropModalDivNotFound)}function l(o,r){var l;l=void 0!==r?a(o,r):n(o),d(o,l);var s=o.find(".uploaded");s.css({width:l.previewWidth+"px",height:l.previewHeight+"px"});var p=o.find(".js-preview");p.addClass("hide").css({width:l.previewWidth+"px",height:l.previewHeight+"px"});var u=s.find("img");u.length?(l.previewHeight=u.height(),l.previewWidth=u.width()):(void 0===l.previewHeight&&(l.previewHeight=f.previewHeight),void 0===l.previewWidth&&(l.previewWidth=f.previewWidth));var v=i("#"+l.lockModalDivId),c=i("#"+l.cropModalDivId);return{objects:{cropModalDiv:c,cropButton:o},url:l.url,data:l.data,imageAutoOrientation:!0,accept:"image/*",imageSize:{minWidth:l.minWidth,minHeight:l.minHeight},imageTransform:{type:"image/jpeg",quality:1,maxWidth:l.minWidth,maxHeight:l.minHeight},imageOriginal:!1,elements:{active:{show:".js-upload",hide:".js-browse"},preview:!1,progress:!1},onSelect:function(i,o){var r=o.all[0],n=o.files[0];FileAPI.support.transform?n?(h=n,FileAPI.getInfo(h,function(i,o){var r=t(o,l.minWidth,l.minHeight);FileAPI.Image(h).resize(r.newFileWidth,r.newFileHeight).get(function(i,t){c.find(".js-img").html(t),e(c,r),s.addClass("hide"),p.removeClass("hide"),c.modal("show")})})):r&&FileAPI.getInfo(r,function(){l.onError(g.requireMinImageSize(l.minWidth,l.minHeight))}):l.onError(g.flashNotSupported)},onUpload:function(i,e){v.length&&v.modal("show")},onFileComplete:function(i,e){if(e.error)c.modal("hide"),l.onError(g.serverError);else if(e.result.result){var t=e.result.image;s.html('<img src="'+t+'" style="height:'+l.previewHeight+"px; width:"+l.previewWidth+'px" />').removeClass("hide"),p.addClass("hide"),c.modal("hide"),l.onSuccess(e.result)}else c.modal("hide"),l.onError(e.result.reason);v.length&&v.modal("hide")}}}function s(e){FileAPI.getInfo(h,function(o,r){var n=e.objects.cropModalDiv,a=e.objects.cropButton,d=t(r,e.imageSize.minWidth,e.imageSize.minHeight);i(".js-img canvas",n).Jcrop({aspectRatio:d.aspectRatio,bgFade:!0,bgOpacity:.5,handleOpacity:.7,createHandles:["nw","ne","se","sw"],borderOpacity:0,keySupport:!1,minSize:[d.minWidth,d.minHeight],file:h,setSelect:[d.fileWidth/2-d.minWidth/2,d.fileHeight/2-d.minHeight/2,d.fileWidth/2+d.minWidth/2,d.fileHeight/2+d.minHeight/2],trueSize:[d.fileWidth,d.fileHeight],onSelect:function(i){a.fileapi("crop",h,i)}})})}function p(i){var e=i.objects.cropModalDiv,t=i.objects.cropButton;e.on("shown.bs.modal",function(){s(i)}),e.on("click",'button[type="submit"]',function(){t.fileapi("upload")}),e.on("hidden.bs.modal",function(){t.find("div.uploaded").removeClass("hide"),t.find("div.js-preview").addClass("hide"),e.find("canvas").remove()})}function u(e){var t=i(this),o=l(t,e);t.fileapi(o),p(o)}function v(i,e){switch(i){case"generateCropModalDivOptions":r(e)}}var h,c=0,m={titleText:"Crop image interface",closeBtnText:"Close",saveBtnText:"Save changes"},g={actionUrlRequired:'Action url required. Use data attribute "data-url" or set in js initialize script',cropModalDivNotExists:function(i){return"cropModalDiv not exist (UID: "+i+")"},flashNotSupported:"Your browser does not support HTML5 and Flash :(",requireMinImageSize:function(i,e){return"<p>Файл должен быть изображением.</p><p>Минимальный размер: <strong>"+i+"px</strong> x <strong>"+e+"px</p>"},uploadedDivNotFount:"Uploaded div not found. Required element with class .uploaded",previewDivNotFount:"Preview div not found. Required element with class .js-preview",serverError:"При обработке произошла ошибка.<br />Повторите попытку.",browseDivNotFount:"Browse div not found. Required element with class .js-browse",fileInputNotFount:'File input element not found. Required input[type="file"]',imageAreaInCropModalDivNotFound:"Not found image area element in crop modal interface. Require div with class .js-img",submitButtonInCropModalDivNotFound:'Not fount submit button in crop modal interface. Require button[type="submit"]'},f={url:"",data:{type:"circle"},cropModalDivId:function(){return o()},minWidth:200,minHeight:200,previewHeight:200,previewWidth:200,onError:function(i){throw new Error(i)},onSuccess:function(i){},lockModalDivId:"lockModal"};jQuery.fn.extend({clientSideCropper:u,clientSideCropperConfig:v})}(jQuery),function(i){i(document).ready(function(){i.fn.clientSideCropperConfig("generateCropModalDivOptions",{titleText:"1title",closeBtnText:"2Exit",saveBtnText:"3submit"}),i("#imageDiv1").clientSideCropper({url:"ctrl.php",data:{type:"rectangle"},cropModalDivId:"auto",minWidth:200,minHeight:200,previewHeight:200,previewWidth:200,onError:function(i){alert(i)},onSuccess:function(i){console.log(i)},lockModalDivId:"lockModal"}),i("#imageDiv2").clientSideCropper()})}(jQuery);